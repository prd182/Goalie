define(function(){
    var internals = {};
    var externals = {};

    internals.routes = {
        field: {
            hash: "#field",
            controller: "field-controller"
        }, 
        route2: {
            hash: "#fieldinfo",
            controller: "fieldinfo-controller"
        }
    };

    internals.defaultRoute = "field";
    internals.currentHash = "";

    internals.loadController = function(controllerName){
        internals.currentHash = window.location.hash;

        require(['controllers/' + controllerName], function(controller){
            try{
                controller.start();
            }
            catch(err){
                console.log(err.stack);
                window.location.hash = internals.routes[internals.defaultRoute].hash;
            }
        });
    };

    internals.hashCheck = function(){

    if(window.location.hash === internals.currentHash){
        return;
    }

    var routeName = Object.keys(internals.routes).find(function(name){
        return window.location.hash === internals.routes[name].hash;
    })

    if(!routeName){
        routeName = internals.defaultRoute;
        window.location.hash = internals.routes[internals.defaultRoute].hash;
    }

    internals.loadController(internals.routes[routeName].controller);

    }

    externals.init = function(){
        window.location.hash = window.location.hash || internals.routes[internals.defaultRoute].hash;
        setInterval(internals.hashCheck, 150);
    }

    return externals;


})